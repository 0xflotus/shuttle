// Copyright 2013 Square Inc.
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.

$(document).ready(function() {
  var list = new TranslateReviewList(
      $('#locale'),
      $('#projects'),
      "<%= locale_projects_url('REPLACEME', format: 'json') %>",
      'translation',
      <%= current_user.admin?? '"admin"' : current_user.approved_rfc5646_locales.to_json %>
  );

  $('.locale-bubble a').each(function(_, link) {
    var linkObj = $(link);
    linkObj.click(function() {
      list.setLocale(linkObj.text());
      return false;
    });

    var addFlag = function() {
      var locale = Locale.from_rfc5646(linkObj.text());
      if (!locale) return;
      var image = locale.image();
      if (!image) return;
      var img = $('<img/>').attr('src', image).insertBefore(linkObj);
      $('<span/>').text(' ').insertAfter(img);
    };
    if (window.localesLoaded) addFlag();
    else $(document).bind('locales_loaded', addFlag);
  });
});
